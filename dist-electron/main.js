"use strict";const e=require("electron"),t=require("path"),n=require("fs"),a=require("os"),r=require("net");function i(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const n in e)if("default"!==n){const a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}require("dgram");const o=i(t),s=i(n),c=i(a),l=i(r),m="development"===process.env.NODE_ENV;let d=null,p=null;try{p=require("./native/transfer.node")}catch(b){}const u=()=>{d?d.focus():(d=new e.BrowserWindow({width:1200,height:600,minWidth:1200,minHeight:600,frame:!1,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:t.join(__dirname,"preload.js"),devTools:!0},show:!1,autoHideMenuBar:!0,icon:void 0}),m?(d.loadURL("http://localhost:5173"),d.webContents.openDevTools()):d.loadFile(t.join(__dirname,"../dist/index.html")),d.once("ready-to-show",()=>{null==d||d.show()}),d.on("closed",()=>{d=null}))};e.ipcMain.on("minimize",()=>{null==d||d.minimize()}),e.ipcMain.on("maximize",()=>{null==d||d.maximize(),(null==d?void 0:d.isMaximized)&&d.getMaximumSize()}),e.ipcMain.on("close",()=>{null==d||d.close()}),e.ipcMain.handle("start-transfer",async(e,{targetDevice:t,files:n})=>{try{const e=g();return p?await p.startTransfer(e,t,n):await y(e,t,n)}catch(b){throw b}}),e.ipcMain.handle("get-system-info",()=>f()),e.ipcMain.handle("get-network-interfaces",()=>h()),e.ipcMain.handle("optimize-system",async()=>{try{return p&&await p.optimizeSystem(),{success:!0}}catch(b){return{success:!1,error:b.message}}}),e.ipcMain.handle("select-files",async()=>{const t=await e.dialog.showOpenDialog(d,{properties:["openFile","multiSelections"],filters:[{name:"All Files",extensions:["*"]}]});if(!t.canceled){return await Promise.all(t.filePaths.map(async e=>{const t=await s.promises.stat(e);return{path:e,name:o.basename(e),size:t.size,type:o.extname(e)}}))}return[]});const f=()=>({platform:c.platform(),arch:c.arch(),cpus:c.cpus().length,totalMemory:c.totalmem(),freeMemory:c.freemem(),hostname:c.hostname(),nativeAcceleration:!!p}),h=()=>{const e=c.networkInterfaces(),t=[];for(const[n,a]of Object.entries(e))if(a)for(const e of a)e.internal||"IPv4"!==e.family||t.push({name:n,address:e.address,netmask:e.netmask,mac:e.mac,broadcast:w(e.address,e.netmask)});return t},w=(e,t)=>{const n=e.split(".").map(Number),a=t.split(".").map(Number);return n.map((e,t)=>e|255-a[t]).join(".")},g=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),y=async(e,t,n)=>new Promise((a,r)=>{const i=l.createConnection(t.port,t.ip);i.on("connect",()=>{const t={transferId:e,filename:n[0].name,size:n[0].size};i.write(JSON.stringify(t));s.createReadStream(n[0].path).pipe(i),a({transferId:e,status:"started"})}),i.on("error",r)});e.app.whenReady().then(u),e.app.on("window-all-closed",()=>{process.platform}),e.app.on("activate",()=>{0===e.BrowserWindow.getAllWindows().length&&u()}),e.app.on("web-contents-created",(e,t)=>{t.setWindowOpenHandler(()=>({action:"deny"}))});
